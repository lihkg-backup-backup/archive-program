{"tid":690658,"cid":26,"subCid":0,"title":"有無人可以解答下關於token based authentication + (REST) API 點implement","createTime":"2018-06-05T05:02:44.000Z","updateTime":"2018-06-05T13:15:22.000Z","uid":9248,"like":1,"dislike":0,"uniUserReply":7,"replies":[{"pid":"70fec1cfb837347d798f8f9549fc2a1b71fe7806","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2018-06-05T05:02:44.000Z","msg":"睇咗幾日做authentication嘅資料 但都唔係完全清楚<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /> <br />\n<br />\n<strong>TL;DR</strong><br />\n想implement LIHKG呢種login &amp; server communication 方式<br />\n1. 有username/email + password login 再加 <strong>social login</strong> (e.g. Google)<br />\n2. Keep 住 user login (reopen browser都仲係Login緊)<br />\n3. 1個API (JSON response) 應付到晒web+app<br />\n<br />\n應該點做; 用咩tect stack<br />\n----------------------------------------------<br />\nQ1.  連登web 唔係用緊token based authentication?<br />\n睇cookies 係有PHPSESSID呢個field<br />\n但mobile 係唔會有cookies<br />\n所以backend API係用緊2種方式去verify個request?  (唔識睇app嘅http request, 我諗mobile+app係share 緊同一個API?<br />\n<br />\n<br />\n----------------------------------------------<br />\nQ2.  想做SPA-only (無session資料), 係咪唔應該做keep user login (after reopen browser)<br />\n(因為唔應該store refresh token?)<br />\n<br />\n<br />\n----------------------------------------------<br />\nQ3 假設放寬requirement; reopen browser 或者 一段時間唔用個web 都要重新login, 咁點做?<br />\nlogin用 username, password =&gt; 攞access token (e.g. valid for 30 minutes)<br />\n30分鐘後要再login?<br />\n我睇過有做法係user keep住active, 就可以keep住login status; 但唔係好明點做<br />\n我諗係每次用access token, server會出個新access token?<br />\n但咁咪變咗access token會永遠都valid? <br />\n(即係hacker somehow偷到access token, 咁咪永遠都revoke唔到hacker嘅access)<br />\n<br />\n<br />\n<br />\n可以拋下d point/link出嚟就得<br />\n我唔明再問<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /> <img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />"},{"pid":"64ac357cc62efd8407b6b2a485c490c35ae3801b","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2018-06-05T05:31:29.000Z","msg":"另外想搞清楚restful API先<br />\n<br />\n用token = stateless<br />\nSession = stateful<br />\n<br />\nHence LIHKG嘅API唔係RESTful API?<br />\n<br />\n我知RESTful唔係必要<br />\n不過想分清concept <img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" />"},{"pid":"9f5272bba12054ebcbf283844698e591e4088411","tid":690658,"uid":116953,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2018-06-05T07:22:00.000Z","msg":"你用唔同URL去拎唔同資料咪就係Rest<br />\n<br />\n我之前都考慮過你呢個問題<br />\n<br />\n用 JWT 去做 token<br />\n你簡單D想做一次就 support 唔同既 auth 方法可以用 passportjs<br />\n<br />\nLogin 果時比個 password auth server 拎張 token<br />\n用 auth server 既 token 去 resource server 拎 data<br />\n<br />\n你可以 keep 住個 login status<br />\nJWT 可以自帶 expiry date<br />\n咁你用 <a href=\"http://jwt.io\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fjwt.io&d=lY5kZ2wbYh2qA7mbLejyKjM0pwszV1jUpWwTgNsMWwc%3D&h=8817b4d9\" data-auto-link target=\"_blank\">jwt.io</a> 可以 decode 拎返個 expiry dat\be 出來<br />\n到左 expiry date 就彈返佢出去要佢 relogin<br />\n或者用舊 token 去 renew token<br />\n<br />\n利申：構思左但未寫好"},{"pid":"9cb1b6e6bc9941f34632868fa87a0384bc699491","tid":690658,"uid":128096,"like":0,"dislike":0,"score":0,"quote":{"pid":"9f5272bba12054ebcbf283844698e591e4088411","tid":690658,"uid":116953,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2018-06-05T07:22:00.000Z","msg":"你用唔同URL去拎唔同資料咪就係Rest<br />\n<br />\n我之前都考慮過你呢個問題<br />\n<br />\n用 JWT 去做 token<br />\n你簡單D想做一次就 support 唔同既 auth 方法可以用 passportjs<br />\n<br />\nLogin 果時比個 password auth server 拎張 token<br />\n用 auth server 既 token 去 resource server 拎 data<br />\n<br />\n你可以 keep 住個 login status<br />\nJWT 可以自帶 expiry date<br />\n咁你用 <a href=\"http://jwt.io\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fjwt.io&d=lY5kZ2wbYh2qA7mbLejyKjM0pwszV1jUpWwTgNsMWwc%3D&h=8817b4d9\" data-auto-link target=\"_blank\">jwt.io</a> 可以 decode 拎返個 expiry dat\be 出來<br />\n到左 expiry date 就彈返佢出去要佢 relogin<br />\n或者用舊 token 去 renew token<br />\n<br />\n利申：構思左但未寫好"},"citedBy":1,"replyTime":"2018-06-05T07:48:12.000Z","msg":"咁想請問一下 <br />\n如果個user 關左個app 之後 <br />\n個user 重開個app 點先可以keep 住login ? <br />\n<br />\n係咪開返個app 後send token 去server verify 返？"},{"pid":"e402287a97af666466b433c134b2c36ac4043273","tid":690658,"uid":116953,"like":0,"dislike":0,"score":0,"quote":{"pid":"9cb1b6e6bc9941f34632868fa87a0384bc699491","tid":690658,"uid":128096,"like":0,"dislike":0,"score":0,"quote":{"pid":"9f5272bba12054ebcbf283844698e591e4088411","tid":690658,"uid":116953,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2018-06-05T07:22:00.000Z","msg":"你用唔同URL去拎唔同資料咪就係Rest<br />\n<br />\n我之前都考慮過你呢個問題<br />\n<br />\n用 JWT 去做 token<br />\n你簡單D想做一次就 support 唔同既 auth 方法可以用 passportjs<br />\n<br />\nLogin 果時比個 password auth server 拎張 token<br />\n用 auth server 既 token 去 resource server 拎 data<br />\n<br />\n你可以 keep 住個 login status<br />\nJWT 可以自帶 expiry date<br />\n咁你用 <a href=\"http://jwt.io\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fjwt.io&d=lY5kZ2wbYh2qA7mbLejyKjM0pwszV1jUpWwTgNsMWwc%3D&h=8817b4d9\" data-auto-link target=\"_blank\">jwt.io</a> 可以 decode 拎返個 expiry dat\be 出來<br />\n到左 expiry date 就彈返佢出去要佢 relogin<br />\n或者用舊 token 去 renew token<br />\n<br />\n利申：構思左但未寫好"},"citedBy":1,"replyTime":"2018-06-05T07:48:12.000Z","msg":"咁想請問一下 <br />\n如果個user 關左個app 之後 <br />\n個user 重開個app 點先可以keep 住login ? <br />\n<br />\n係咪開返個app 後send token 去server verify 返？"},"citedBy":0,"replyTime":"2018-06-05T07:58:21.000Z","msg":"如果佢個 token 未 expired 應該繼續用"},{"pid":"f8504e97ceb6379d2c039bfec3e6ff15af38feb8","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:29:57.000Z","msg":"連登係token based 個session cookies唔係api到用"},{"pid":"ba5b567ddc1e78adea4d865c57a11a742579d76d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"f8504e97ceb6379d2c039bfec3e6ff15af38feb8","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:29:57.000Z","msg":"連登係token based 個session cookies唔係api到用"},"citedBy":1,"replyTime":"2018-06-05T08:40:18.000Z","msg":"可唔可以講多啲<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /> <br />\n睇header唔見有authorization header"},{"pid":"af6ea63014dc84adc2fc7ef81c9341499fc1429e","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"ba5b567ddc1e78adea4d865c57a11a742579d76d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"f8504e97ceb6379d2c039bfec3e6ff15af38feb8","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:29:57.000Z","msg":"連登係token based 個session cookies唔係api到用"},"citedBy":1,"replyTime":"2018-06-05T08:40:18.000Z","msg":"可唔可以講多啲<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /> <br />\n睇header唔見有authorization header"},"citedBy":1,"replyTime":"2018-06-05T08:41:21.000Z","msg":"連登有頁係php黎 登入改密碼同買plus個頁用緊session做 所以你先會見到有PHPSESSION"},{"pid":"87e0d1cfee51a1615c9beb450f44331d664f32bc","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"9f5272bba12054ebcbf283844698e591e4088411","tid":690658,"uid":116953,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2018-06-05T07:22:00.000Z","msg":"你用唔同URL去拎唔同資料咪就係Rest<br />\n<br />\n我之前都考慮過你呢個問題<br />\n<br />\n用 JWT 去做 token<br />\n你簡單D想做一次就 support 唔同既 auth 方法可以用 passportjs<br />\n<br />\nLogin 果時比個 password auth server 拎張 token<br />\n用 auth server 既 token 去 resource server 拎 data<br />\n<br />\n你可以 keep 住個 login status<br />\nJWT 可以自帶 expiry date<br />\n咁你用 <a href=\"http://jwt.io\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fjwt.io&d=lY5kZ2wbYh2qA7mbLejyKjM0pwszV1jUpWwTgNsMWwc%3D&h=8817b4d9\" data-auto-link target=\"_blank\">jwt.io</a> 可以 decode 拎返個 expiry dat\be 出來<br />\n到左 expiry date 就彈返佢出去要佢 relogin<br />\n或者用舊 token 去 renew token<br />\n<br />\n利申：構思左但未寫好"},"citedBy":0,"replyTime":"2018-06-05T08:43:11.000Z","msg":"想keep住login<br />\n<br />\nso far 用開嘅大部份website都唔會auto logout個user<img src=\"/assets/faces/normal/banghead.gif\" class=\"hkgmoji\" /> <br />\n我見好多人教SPA都係話定時定候要relogin<br />\n但自己就好少咁遇到"},{"pid":"c695931018bb8157e766820d850878b95609511e","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2018-06-05T08:43:29.000Z","msg":"其他兩個問題都係直接用JWT做 啱哂你要求<br />\n可以做到always login / expired at"},{"pid":"0bd21e258effec6741497ba015c81708155bd31d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"af6ea63014dc84adc2fc7ef81c9341499fc1429e","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"ba5b567ddc1e78adea4d865c57a11a742579d76d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"f8504e97ceb6379d2c039bfec3e6ff15af38feb8","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:29:57.000Z","msg":"連登係token based 個session cookies唔係api到用"},"citedBy":1,"replyTime":"2018-06-05T08:40:18.000Z","msg":"可唔可以講多啲<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /> <br />\n睇header唔見有authorization header"},"citedBy":1,"replyTime":"2018-06-05T08:41:21.000Z","msg":"連登有頁係php黎 登入改密碼同買plus個頁用緊session做 所以你先會見到有PHPSESSION"},"citedBy":2,"replyTime":"2018-06-05T08:44:27.000Z","msg":"咁點樣keep住update token?"},{"pid":"3edeba8d8351d64e94a28d6b5f989b093b292c0d","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"0bd21e258effec6741497ba015c81708155bd31d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"af6ea63014dc84adc2fc7ef81c9341499fc1429e","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"ba5b567ddc1e78adea4d865c57a11a742579d76d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:40:18.000Z","msg":"可唔可以講多啲<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /> <br />\n睇header唔見有authorization header"},"citedBy":1,"replyTime":"2018-06-05T08:41:21.000Z","msg":"連登有頁係php黎 登入改密碼同買plus個頁用緊session做 所以你先會見到有PHPSESSION"},"citedBy":2,"replyTime":"2018-06-05T08:44:27.000Z","msg":"咁點樣keep住update token?"},"citedBy":2,"replyTime":"2018-06-05T08:45:07.000Z","msg":"連登token冇做expired time<img src=\"/assets/faces/normal/no.gif\" class=\"hkgmoji\" />"},{"pid":"c74e9514e696d34eaf2f047966fed2d2a144cf25","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"3edeba8d8351d64e94a28d6b5f989b093b292c0d","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"0bd21e258effec6741497ba015c81708155bd31d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"af6ea63014dc84adc2fc7ef81c9341499fc1429e","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:41:21.000Z","msg":"連登有頁係php黎 登入改密碼同買plus個頁用緊session做 所以你先會見到有PHPSESSION"},"citedBy":2,"replyTime":"2018-06-05T08:44:27.000Z","msg":"咁點樣keep住update token?"},"citedBy":2,"replyTime":"2018-06-05T08:45:07.000Z","msg":"連登token冇做expired time<img src=\"/assets/faces/normal/no.gif\" class=\"hkgmoji\" />"},"citedBy":0,"replyTime":"2018-06-05T08:48:08.000Z","msg":"<img src=\"/assets/faces/normal/@.gif\" class=\"hkgmoji\" />"},{"pid":"67eb228b3b4f7041956d16c8ef261174b8db9fdd","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"3edeba8d8351d64e94a28d6b5f989b093b292c0d","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"0bd21e258effec6741497ba015c81708155bd31d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"af6ea63014dc84adc2fc7ef81c9341499fc1429e","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:41:21.000Z","msg":"連登有頁係php黎 登入改密碼同買plus個頁用緊session做 所以你先會見到有PHPSESSION"},"citedBy":2,"replyTime":"2018-06-05T08:44:27.000Z","msg":"咁點樣keep住update token?"},"citedBy":2,"replyTime":"2018-06-05T08:45:07.000Z","msg":"連登token冇做expired time<img src=\"/assets/faces/normal/no.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2018-06-05T08:53:41.000Z","msg":"連登好似唔係用JWT Token (其實邊個header key係token?)<br />\n即係每次API request 都要database check token?<br />\n<br />\n改password就revoke晒account所有token<br />\nlogout就revoke嗰個token?"},{"pid":"a4b62e65e337f8ac789ab83a407a0e1ac48565fe","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"67eb228b3b4f7041956d16c8ef261174b8db9fdd","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"3edeba8d8351d64e94a28d6b5f989b093b292c0d","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"0bd21e258effec6741497ba015c81708155bd31d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2018-06-05T08:44:27.000Z","msg":"咁點樣keep住update token?"},"citedBy":2,"replyTime":"2018-06-05T08:45:07.000Z","msg":"連登token冇做expired time<img src=\"/assets/faces/normal/no.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2018-06-05T08:53:41.000Z","msg":"連登好似唔係用JWT Token (其實邊個header key係token?)<br />\n即係每次API request 都要database check token?<br />\n<br />\n改password就revoke晒account所有token<br />\nlogout就revoke嗰個token?"},"citedBy":1,"replyTime":"2018-06-05T08:59:54.000Z","msg":"連登token自己寫 <code>x-li-digest</code> 入面包住user token 同 endpoint之類既野<br />\n同埋logout冇revoke過token 你logout前record返個localStorage user既value <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" /> <br />\n登出再人手加返個json入去就會登入返 <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" />"},{"pid":"aeb8cf32d611ac0e47945da635d07caece20ba0a","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"a4b62e65e337f8ac789ab83a407a0e1ac48565fe","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"67eb228b3b4f7041956d16c8ef261174b8db9fdd","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"3edeba8d8351d64e94a28d6b5f989b093b292c0d","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2018-06-05T08:45:07.000Z","msg":"連登token冇做expired time<img src=\"/assets/faces/normal/no.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2018-06-05T08:53:41.000Z","msg":"連登好似唔係用JWT Token (其實邊個header key係token?)<br />\n即係每次API request 都要database check token?<br />\n<br />\n改password就revoke晒account所有token<br />\nlogout就revoke嗰個token?"},"citedBy":1,"replyTime":"2018-06-05T08:59:54.000Z","msg":"連登token自己寫 <code>x-li-digest</code> 入面包住user token 同 endpoint之類既野<br />\n同埋logout冇revoke過token 你logout前record返個localStorage user既value <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" /> <br />\n登出再人手加返個json入去就會登入返 <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2018-06-05T09:01:09.000Z","msg":"但係改密碼就有revoke token"},{"pid":"873a0c4c082bb6e04b0eaa900a1e075b2929e85f","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"aeb8cf32d611ac0e47945da635d07caece20ba0a","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"a4b62e65e337f8ac789ab83a407a0e1ac48565fe","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"67eb228b3b4f7041956d16c8ef261174b8db9fdd","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:53:41.000Z","msg":"連登好似唔係用JWT Token (其實邊個header key係token?)<br />\n即係每次API request 都要database check token?<br />\n<br />\n改password就revoke晒account所有token<br />\nlogout就revoke嗰個token?"},"citedBy":1,"replyTime":"2018-06-05T08:59:54.000Z","msg":"連登token自己寫 <code>x-li-digest</code> 入面包住user token 同 endpoint之類既野<br />\n同埋logout冇revoke過token 你logout前record返個localStorage user既value <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" /> <br />\n登出再人手加返個json入去就會登入返 <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2018-06-05T09:01:09.000Z","msg":"但係改密碼就有revoke token"},"citedBy":1,"replyTime":"2018-06-05T10:07:48.000Z","msg":"明白晒 <br />\n我自己覺得永久嘅token唔係咩大問題<br />\n<br />\n但係如果想喺呢種setting下加oauth2 login (e.g. google)嘅話可以點做?<br />\n<br />\nauthorization code flow<br />\n1. sign in with google <br />\n2. client app 攞到authorization code, 然後 send個code上API<br />\n3. API用authorization code攞access token, refresh token<br />\n4. verify access token<br />\n5. 無問題嘅話store refresh token落databse (每個user淨係keep一個refresh token; given that 即使相同email, password login同google login係2個user)<br />\n6. issue自己嘅JWT token with expiration time <br />\n7. return JWT token to user<br />\n<br />\n攞API resources<br />\n1. client 用JWT token request API<br />\n2a. if not expired =&gt; 直接用token裡面嘅user資料<br />\n2b. expired就入database攞google refresh token<br />\n3. 用refresh token 攞access token (攞到access token代表 個google user無改password/logout all devices之類)<br />\n4. 攞到access token嘅話就去返處理API request<br />\n5. issue 新JWT token<br />\n6. 將data連token return畀user<br />\n<br />\n呢個flow有無問題<img src=\"/assets/faces/normal/wonder.gif\" class=\"hkgmoji\" />"},{"pid":"17207ee3a0458c46770300f42d046d5b8e7f6eb1","tid":690658,"uid":23953,"like":0,"dislike":0,"score":0,"quote":{"pid":"873a0c4c082bb6e04b0eaa900a1e075b2929e85f","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"aeb8cf32d611ac0e47945da635d07caece20ba0a","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"a4b62e65e337f8ac789ab83a407a0e1ac48565fe","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:59:54.000Z","msg":"連登token自己寫 <code>x-li-digest</code> 入面包住user token 同 endpoint之類既野<br />\n同埋logout冇revoke過token 你logout前record返個localStorage user既value <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" /> <br />\n登出再人手加返個json入去就會登入返 <img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2018-06-05T09:01:09.000Z","msg":"但係改密碼就有revoke token"},"citedBy":1,"replyTime":"2018-06-05T10:07:48.000Z","msg":"明白晒 <br />\n我自己覺得永久嘅token唔係咩大問題<br />\n<br />\n但係如果想喺呢種setting下加oauth2 login (e.g. google)嘅話可以點做?<br />\n<br />\nauthorization code flow<br />\n1. sign in with google <br />\n2. client app 攞到authorization code, 然後 send個code上API<br />\n3. API用authorization code攞access token, refresh token<br />\n4. verify access token<br />\n5. 無問題嘅話store refresh token落databse (每個user淨係keep一個refresh token; given that 即使相同email, password login同google login係2個user)<br />\n6. issue自己嘅JWT token with expiration time <br />\n7. return JWT token to user<br />\n<br />\n攞API resources<br />\n1. client 用JWT token request API<br />\n2a. if not expired =&gt; 直接用token裡面嘅user資料<br />\n2b. expired就入database攞google refresh token<br />\n3. 用refresh token 攞access token (攞到access token代表 個google user無改password/logout all devices之類)<br />\n4. 攞到access token嘅話就去返處理API request<br />\n5. issue 新JWT token<br />\n6. 將data連token return畀user<br />\n<br />\n呢個flow有無問題<img src=\"/assets/faces/normal/wonder.gif\" class=\"hkgmoji\" />"},"citedBy":0,"replyTime":"2018-06-05T11:39:41.000Z","msg":"除咗你寫到1999外，冇問題"},{"pid":"f920b81ecea7d4c795c75ad6aa80165b84437627","tid":690658,"uid":10009,"like":0,"dislike":0,"score":0,"quote":{"pid":"0bd21e258effec6741497ba015c81708155bd31d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"af6ea63014dc84adc2fc7ef81c9341499fc1429e","tid":690658,"uid":2341,"like":0,"dislike":0,"score":0,"quote":{"pid":"ba5b567ddc1e78adea4d865c57a11a742579d76d","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T08:40:18.000Z","msg":"可唔可以講多啲<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /> <br />\n睇header唔見有authorization header"},"citedBy":1,"replyTime":"2018-06-05T08:41:21.000Z","msg":"連登有頁係php黎 登入改密碼同買plus個頁用緊session做 所以你先會見到有PHPSESSION"},"citedBy":2,"replyTime":"2018-06-05T08:44:27.000Z","msg":"咁點樣keep住update token?"},"citedBy":0,"replyTime":"2018-06-05T11:53:09.000Z","msg":"你可以每次response 都係Header夾個新token落去比client食咗佢 <br />\n<br />\nbtw 可以research多d &quot;how to store token&quot;<br />\nhttponly cookie: <a href=\"https://github.com/feathersjs/authentication/issues/132\" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fgithub.com%2Ffeathersjs%2Fauthentication%2Fissues%2F132&d=lY5kZ2wbYh2qA7mbLejyKjM0pwszV1jUpWwTgNsMWwc%3D&h=65a04b03\" data-auto-link target=\"_blank\">https://github.com/feathersjs/authentication/issues/132</a>"},{"pid":"d54f6ad0347bb874731296cb67cf25edfeb000e0","tid":690658,"uid":28563,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2018-06-05T11:57:19.000Z","msg":"Login: user/password得過左，gen token&amp;放redis/any kv db (xxxxx-&gt;uid)&amp;return比user<br />\n<br />\nAuth: user client side將token放係Authorization: Bearer xxxxx，因為server儲xxxxx-&gt;uid係redis/any kv db，用xxxxx讀返uid，完成auth<br />\n<br />\nToken expire: redis setex<br />\n<br />\nLogout: delete xxxxx<br />\n<br />\nExpire左: http 401，prompt user再login"},{"pid":"5a27ba470862e09bd08c9b22f87e98a5c2494f8d","tid":690658,"uid":28563,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T12:06:24.000Z","msg":"Facebook/Google signin: 用firebase auth，user係client side login fb/google之後，google會return條token比client side，將token寫入cookie就得<br />\n<br />\nEmail+password同樣，password唔洗都唔應該儲係自己server，而係直接比email+password入client side既firebase<br />\n<br />\n條token係cryptographicallg signed，jwt黎，假唔到，一定時間後會自己expire，所以如果expire左要令client side refresh條token<br />\n<br />\nAuth: server收到條jwt token，用firebase提供既library拆成firebase user id同其他user info (google email or fb email等)，用firebase id係database睇下搵唔搵到user，搵唔到當未register，redirect佢去register page填username&hellip;，搵到當已經register+login左"},{"pid":"fc2cb915c7f9dd1e1be75c730b6ed9687b28498b","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"5a27ba470862e09bd08c9b22f87e98a5c2494f8d","tid":690658,"uid":28563,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T12:06:24.000Z","msg":"Facebook/Google signin: 用firebase auth，user係client side login fb/google之後，google會return條token比client side，將token寫入cookie就得<br />\n<br />\nEmail+password同樣，password唔洗都唔應該儲係自己server，而係直接比email+password入client side既firebase<br />\n<br />\n條token係cryptographicallg signed，jwt黎，假唔到，一定時間後會自己expire，所以如果expire左要令client side refresh條token<br />\n<br />\nAuth: server收到條jwt token，用firebase提供既library拆成firebase user id同其他user info (google email or fb email等)，用firebase id係database睇下搵唔搵到user，搵唔到當未register，redirect佢去register page填username&hellip;，搵到當已經register+login左"},"citedBy":1,"replyTime":"2018-06-05T13:11:17.000Z","msg":"我諗最後都係用佢算<br />\n夠晒快<img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" />"},{"pid":"9cab3c61d360ef5e1b71f50884f55dd26871308d","tid":690658,"uid":28563,"like":0,"dislike":0,"score":0,"quote":{"pid":"fc2cb915c7f9dd1e1be75c730b6ed9687b28498b","tid":690658,"uid":9248,"like":0,"dislike":0,"score":0,"quote":{"pid":"5a27ba470862e09bd08c9b22f87e98a5c2494f8d","tid":690658,"uid":28563,"like":0,"dislike":0,"score":0,"citedBy":1,"replyTime":"2018-06-05T12:06:24.000Z","msg":"Facebook/Google signin: 用firebase auth，user係client side login fb/google之後，google會return條token比client side，將token寫入cookie就得<br />\n<br />\nEmail+password同樣，password唔洗都唔應該儲係自己server，而係直接比email+password入client side既firebase<br />\n<br />\n條token係cryptographicallg signed，jwt黎，假唔到，一定時間後會自己expire，所以如果expire左要令client side refresh條token<br />\n<br />\nAuth: server收到條jwt token，用firebase提供既library拆成firebase user id同其他user info (google email or fb email等)，用firebase id係database睇下搵唔搵到user，搵唔到當未register，redirect佢去register page填username&hellip;，搵到當已經register+login左"},"citedBy":1,"replyTime":"2018-06-05T13:11:17.000Z","msg":"我諗最後都係用佢算<br />\n夠晒快<img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" />"},"citedBy":0,"replyTime":"2018-06-05T13:15:22.000Z","msg":"係，唔洗儲password，唔洗handle email認證，唔洗handle改password logic，贏晒"}]}