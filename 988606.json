{"tid":988606,"cid":22,"subCid":0,"title":"Qnap NAS 的 crontab 為什麼不是每分鐘運行","createTime":"2019-01-20T08:25:59.000Z","updateTime":"2019-01-20T15:05:36.000Z","uid":190783,"like":0,"dislike":1,"uniUserReply":5,"replies":[{"pid":"4f655bf8abc55dc7713e95d2d9a4137095f0b3b4","tid":988606,"uid":190783,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2019-01-20T08:25:59.000Z","msg":"型號為TS251<br />\n<br />\n<a href=\"https://wiki.qnap.com/wiki/Add_items_to_crontab\" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fwiki.qnap.com%2Fwiki%2FAdd_items_to_crontab&d=HiUNBysZrE9nbvaLZxqmO6EKYqckrLkk14koP0tj2xA%3D&h=d297be4c\" data-auto-link target=\"_blank\">https://wiki.qnap.com/wiki/Add_items_to_crontab</a><br />\n我根據這篇設定了crontab，我測試可以運作，問題其中一個設定<br />\n* * * * * wget -qO /dev/null <a href=\"http://asdf.myqnapcloud.com/abc.php\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fasdf.myqnapcloud.com%2Fabc.php&d=HiUNBysZrE9nbvaLZxqmO6EKYqckrLkk14koP0tj2xA%3D&h=bebc08bc\" data-auto-link target=\"_blank\">http://asdf.myqnapcloud.com/abc.php</a><br />\n<br />\n理論上NAS會每分鐘call此php一次<br />\n但實際上NAS會每兩分鐘才call此php一次<br />\n有什麼方法可修正成一分鐘一次？<br />\n還是Qnap的NAS crontab 的 * * * * *是兩分鐘為一個單位的？"},{"pid":"0c53df4f7675a2233a8393d543d1dd0757863da7","tid":988606,"uid":17705,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-01-20T09:00:11.000Z","msg":"你唔知***點解？"},{"pid":"bb57b262e3a436208baadf69e0e5770e0d2030aa","tid":988606,"uid":190783,"like":0,"dislike":0,"score":0,"quote":{"pid":"0c53df4f7675a2233a8393d543d1dd0757863da7","tid":988606,"uid":17705,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-01-20T09:00:11.000Z","msg":"你唔知***點解？"},"citedBy":1,"replyTime":"2019-01-20T09:10:21.000Z","msg":"知，這個設定在一般server係無事可以每分鐘運行正確的，但放落ts251就不行"},{"pid":"02b42ead879bb63b9733ce2b73e22b5dfacdf6cc","tid":988606,"uid":17738,"like":1,"dislike":0,"score":1,"quote":{"pid":"bb57b262e3a436208baadf69e0e5770e0d2030aa","tid":988606,"uid":190783,"like":0,"dislike":0,"score":0,"quote":{"pid":"0c53df4f7675a2233a8393d543d1dd0757863da7","tid":988606,"uid":17705,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-01-20T09:00:11.000Z","msg":"你唔知***點解？"},"citedBy":1,"replyTime":"2019-01-20T09:10:21.000Z","msg":"知，這個設定在一般server係無事可以每分鐘運行正確的，但放落ts251就不行"},"citedBy":1,"replyTime":"2019-01-20T11:27:18.000Z","msg":"如果真係唔得，試吓寫成shell script background執行<br />\nscript 寫forever loop + sleep 60, 用nohup執行<br />\n<br />\n例如<br />\n<br />\n<pre><code data-type=\"\">#! /bin/bash\nwhile true ; do\n          wget -qO filename http://whatever.com \n           sleep 60\ndone\n</code></pre><br />\n然後用nohup就算logout都會運行, chmod 755 script.sh,執行<br />\n<pre><code data-type=\"\">nohup script.sh</code></pre>"},{"pid":"a469887779be054eb70482234fa36d27bca021b8","tid":988606,"uid":17738,"like":2,"dislike":0,"score":2,"quote":{"pid":"02b42ead879bb63b9733ce2b73e22b5dfacdf6cc","tid":988606,"uid":17738,"like":1,"dislike":0,"score":1,"quote":{"pid":"bb57b262e3a436208baadf69e0e5770e0d2030aa","tid":988606,"uid":190783,"like":0,"dislike":0,"score":0,"quote":{"pid":"0c53df4f7675a2233a8393d543d1dd0757863da7","tid":988606,"uid":17705,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-01-20T09:00:11.000Z","msg":"你唔知***點解？"},"citedBy":1,"replyTime":"2019-01-20T09:10:21.000Z","msg":"知，這個設定在一般server係無事可以每分鐘運行正確的，但放落ts251就不行"},"citedBy":1,"replyTime":"2019-01-20T11:27:18.000Z","msg":"如果真係唔得，試吓寫成shell script background執行<br />\nscript 寫forever loop + sleep 60, 用nohup執行<br />\n<br />\n例如<br />\n<br />\n<pre><code data-type=\"\">#! /bin/bash\nwhile true ; do\n          wget -qO filename http://whatever.com \n           sleep 60\ndone\n</code></pre><br />\n然後用nohup就算logout都會運行, chmod 755 script.sh,執行<br />\n<pre><code data-type=\"\">nohup script.sh</code></pre>"},"citedBy":0,"replyTime":"2019-01-20T11:31:10.000Z","msg":"sor , 咁先啱<br />\n<br />\n<pre><code data-type=\"\">nohup script.sh &amp;</code></pre><br />\n<br />\n擺去background"},{"pid":"ad12989b6586ee03e43356ec2979dacca2985b8e","tid":988606,"uid":190783,"like":1,"dislike":0,"score":1,"citedBy":0,"replyTime":"2019-01-20T12:20:12.000Z","msg":"我試了一下，NAS的確是每1分鐘call一次<br />\n但我的內容影響了下一個1分鐘的運行<br />\n<br />\nphp的內容是一個do loop，每運行一次就sleep(4);，直到$loop &lt; 12所以是loop 11次<br />\n我預期的目的是每5秒一次一分鐘行11次，接到下一分鐘的00行第一次，就會無間斷5秒運行<br />\n<br />\n看來是每一次一分鐘的作業開始時，會因為上一次未完全完結而令下一次未能開始運行，變成了兩分鐘才運行一次，很複雜，不知怎樣才好..."},{"pid":"38ec4c5e850bf607504706cd006120c0e3ee1ce3","tid":988606,"uid":190783,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-01-20T12:21:19.000Z","msg":"我試了一下，NAS的確是每1分鐘call一次<br />\n但我的內容影響了下一個1分鐘的運行<br />\n<br />\nphp的內容是一個do loop 發出一次curl，每運行一次就sleep(4);，直到$loop &lt; 12所以是loop 11次<br />\n我預期的目的是每5秒一次一分鐘行11次curl，接到下一分鐘的00行第一次，就會無間斷5秒運行<br />\n<br />\n看來是每一次一分鐘的作業開始時，會因為上一次未完全完結而令下一次未能開始運行，變成了兩分鐘才運行一次，很複雜，不知怎樣才好..."},{"pid":"bd8cc5d85699546935ccc681796dd76716c1e1d2","tid":988606,"uid":17889,"like":1,"dislike":0,"score":1,"citedBy":0,"replyTime":"2019-01-20T12:30:04.000Z","msg":"咁係你個cron job太複雜"},{"pid":"fb8886672a782f571fbb96e1522085293d5def28","tid":988606,"uid":17738,"like":1,"dislike":0,"score":1,"citedBy":0,"replyTime":"2019-01-20T12:36:10.000Z","msg":"似乎係program問題，非crontab -e問題"},{"pid":"5923d1b418cd3592adb6ada48c0385c580d5731a","tid":988606,"uid":66004,"like":0,"dislike":0,"score":0,"quote":{"pid":"38ec4c5e850bf607504706cd006120c0e3ee1ce3","tid":988606,"uid":190783,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-01-20T12:21:19.000Z","msg":"我試了一下，NAS的確是每1分鐘call一次<br />\n但我的內容影響了下一個1分鐘的運行<br />\n<br />\nphp的內容是一個do loop 發出一次curl，每運行一次就sleep(4);，直到$loop &lt; 12所以是loop 11次<br />\n我預期的目的是每5秒一次一分鐘行11次curl，接到下一分鐘的00行第一次，就會無間斷5秒運行<br />\n<br />\n看來是每一次一分鐘的作業開始時，會因為上一次未完全完結而令下一次未能開始運行，變成了兩分鐘才運行一次，很複雜，不知怎樣才好..."},"citedBy":0,"replyTime":"2019-01-20T14:50:01.000Z","msg":"諗到兩個方法<br />\n- curl 轉做 async request<br />\n- sleep 轉做 timer，每五秒 fire 一次<br />\n你試下吧"},{"pid":"d014b16290b5795ff803cc49e82cb08b1cdbcc5e","tid":988606,"uid":190783,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2019-01-20T15:05:36.000Z","msg":"謝謝師兄們，我嘗試一下"}]}