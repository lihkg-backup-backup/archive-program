{"tid":49345,"cid":26,"subCid":0,"title":"[c++] function pointer 問題","createTime":"2016-12-21T15:36:05.000Z","updateTime":"2016-12-25T12:00:29.000Z","uid":65030,"like":0,"dislike":0,"uniUserReply":0,"replies":[{"pid":"cf4307fa9b8afff6fd24d7c693bc08f2a5b45b0c","tid":49345,"uid":65030,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-21T15:36:05.000Z","msg":"(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂"},{"pid":"dce23dd3edbcde7ea485cab034507bd0d6292341","tid":49345,"uid":13173,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-21T15:44:42.000Z","msg":"Call返個function?<br />\n<br />\n<br />\n利申:唔撚識"},{"pid":"13e5548e93936786b6b668536a1494972d952193","tid":49345,"uid":13173,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-21T15:47:25.000Z","msg":"<blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n<br />\n(int(*)())應該係cast既野<br />\n<br />\nX應該係個function pointer"},{"pid":"a66e4082c614a4f001d0282a437c80fbd0e63e0c","tid":49345,"uid":13173,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-21T15:49:48.000Z","msg":"<blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n<br />\n(int(*)())應該係cast既野<br />\n<br />\nX應該係個function pointer</blockquote><br />\n<br />\n*(int(*)())左邊粒星應該係解構返個function pointer<br />\n<br />\n最後成舊 （*(int(*)())x) 就當係1個function call返佢"},{"pid":"7ec8ebe538fa6c7d0542ad04bd3da3f0916290f1","tid":49345,"uid":59933,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-21T16:33:01.000Z","msg":"留名"},{"pid":"8978919db5cf9820fd6d5541cb6854892c3c10ed","tid":49345,"uid":67527,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T01:47:57.000Z","msg":"<blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n(*(int (*)())x)();<br />\n啱啱試咗，我估我推論應該無錯<br />\nx係一個function，佢係cast緊一個function做咁樣 int f()，而因為cast緊嘅時候係唔用function name嘅，所以會有(*)。咁樣cast會cast到原本有argument(s)都變無，我估主要係咁，因為如果cast return value做int，唔需要cast得咁複雜，就咁cast個return咗value就得<br />\n不過我都唔清楚<br />\npastebin link就係我試咗嗰個，compile到咩問題都無，又run到<br />\n<a href=\"http://pastebin.com/3jEVNFgF\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fpastebin.com%2F3jEVNFgF&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=40014b4f\" target=\"_blank\">http://pastebin.com/3jEVNFgF</a>"},{"pid":"f9d051370acbfe609a8635600664b5c8a9785e6a","tid":49345,"uid":36459,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T03:38:54.000Z","msg":"路過留名學野"},{"pid":"83d7ad1e20fc81a8fb8d329e16875ea87f0053d3","tid":49345,"uid":63156,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T05:15:04.000Z","msg":"小心function pointer casting會係undefined behaviour"},{"pid":"3a279a995aafc7e9ed78a97760fa194d7731c4b8","tid":49345,"uid":48679,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T05:21:02.000Z","msg":"痴撚線，有無必要咁做？<br />\n家陣叫你寫密碼咩"},{"pid":"63c55cb95f1237bca612e888cb5b07ea1e032b7d","tid":49345,"uid":65030,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T06:30:19.000Z","msg":"<blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n(*(int (*)())x)();<br />\n啱啱試咗，我估我推論應該無錯<br />\nx係一個function，佢係cast緊一個function做咁樣 int f()，而因為cast緊嘅時候係唔用function name嘅，所以會有(*)。咁樣cast會cast到原本有argument(s)都變無，我估主要係咁，因為如果cast return value做int，唔需要cast得咁複雜，就咁cast個return咗value就得<br />\n不過我都唔清楚<br />\npastebin link就係我試咗嗰個，compile到咩問題都無，又run到<br />\n<a href=\"http://pastebin.com/3jEVNFgF\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fpastebin.com%2F3jEVNFgF&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=40014b4f\" target=\"_blank\">http://pastebin.com/3jEVNFgF</a></blockquote><br />\n<br />\n我試過就咁x()都run 到，點解？"},{"pid":"e2751e7d787aa17627ba9d39eaa70996ff609521","tid":49345,"uid":41887,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T06:41:38.000Z","msg":"1. 將 x cast 做 function take nothing and return in，之後call佢<br />\n2. 呢個係undefined behavior<br />\n3. 善用typedef、using，function&lt;T&gt;、lambda<br />\n4. 邊個寫呢段code既拉去打靶<img src=\"/assets/faces/normal/kill.gif\" class=\"hkgmoji\" />"},{"pid":"ae80ea004cccfba6d8384da87351a59e22537a48","tid":49345,"uid":63156,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T06:42:41.000Z","msg":"<blockquote><blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n(*(int (*)())x)();<br />\n啱啱試咗，我估我推論應該無錯<br />\nx係一個function，佢係cast緊一個function做咁樣 int f()，而因為cast緊嘅時候係唔用function name嘅，所以會有(*)。咁樣cast會cast到原本有argument(s)都變無，我估主要係咁，因為如果cast return value做int，唔需要cast得咁複雜，就咁cast個return咗value就得<br />\n不過我都唔清楚<br />\npastebin link就係我試咗嗰個，compile到咩問題都無，又run到<br />\n<a href=\"http://pastebin.com/3jEVNFgF\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fpastebin.com%2F3jEVNFgF&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=40014b4f\" target=\"_blank\">http://pastebin.com/3jEVNFgF</a></blockquote><br />\n<br />\n我試過就咁x()都run 到，點解？</blockquote><br />\n你有冇成段code？<br />\n就咁一句真係唔知想點"},{"pid":"14c6d8d3ded8f569f04514aaa4e0dd17249e6f78","tid":49345,"uid":65030,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T12:52:39.000Z","msg":"<blockquote><blockquote><blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n(*(int (*)())x)();<br />\n啱啱試咗，我估我推論應該無錯<br />\nx係一個function，佢係cast緊一個function做咁樣 int f()，而因為cast緊嘅時候係唔用function name嘅，所以會有(*)。咁樣cast會cast到原本有argument(s)都變無，我估主要係咁，因為如果cast return value做int，唔需要cast得咁複雜，就咁cast個return咗value就得<br />\n不過我都唔清楚<br />\npastebin link就係我試咗嗰個，compile到咩問題都無，又run到<br />\n<a href=\"http://pastebin.com/3jEVNFgF\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fpastebin.com%2F3jEVNFgF&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=40014b4f\" target=\"_blank\">http://pastebin.com/3jEVNFgF</a></blockquote><br />\n<br />\n我試過就咁x()都run 到，點解？</blockquote><br />\n你有冇成段code？<br />\n就咁一句真係唔知想點</blockquote><br />\n#include &lt;iostream&gt;<br />\n<br />\nint foo()<br />\n{<br />\n    std::cout &lt;&lt; &quot;foo\\n&quot;;<br />\n    return 1;<br />\n}<br />\n<br />\nint main()<br />\n{<br />\n    void* fptr = (void*)&amp;::foo;<br />\n    <br />\n    // the following are equivalent<br />\n    ((int (*)())fptr)();<br />\n    (*(int (*)())fptr)();<br />\n}"},{"pid":"73a9479a38ed28bc73383d3c2e78982d8ad1da81","tid":49345,"uid":65030,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T13:01:39.000Z","msg":"<blockquote><blockquote><blockquote><blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n(*(int (*)())x)();<br />\n啱啱試咗，我估我推論應該無錯<br />\nx係一個function，佢係cast緊一個function做咁樣 int f()，而因為cast緊嘅時候係唔用function name嘅，所以會有(*)。咁樣cast會cast到原本有argument(s)都變無，我估主要係咁，因為如果cast return value做int，唔需要cast得咁複雜，就咁cast個return咗value就得<br />\n不過我都唔清楚<br />\npastebin link就係我試咗嗰個，compile到咩問題都無，又run到<br />\n<a href=\"http://pastebin.com/3jEVNFgF\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fpastebin.com%2F3jEVNFgF&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=40014b4f\" target=\"_blank\">http://pastebin.com/3jEVNFgF</a></blockquote><br />\n<br />\n我試過就咁x()都run 到，點解？</blockquote><br />\n你有冇成段code？<br />\n就咁一句真係唔知想點</blockquote><br />\n#include &lt;iostream&gt;<br />\n<br />\nint foo()<br />\n{<br />\n    std::cout &lt;&lt; &quot;foo\\n&quot;;<br />\n    return 1;<br />\n}<br />\n<br />\nint main()<br />\n{<br />\n    void* fptr = (void*)&amp;::foo;<br />\n    <br />\n    // the following are equivalent<br />\n    ((int (*)())fptr)();<br />\n    (*(int (*)())fptr)();<br />\n}</blockquote><br />\n仲有點解((int (*)())fptr)()=(*(int (*)())fptr)()"},{"pid":"2eae83310b3183178a6ef6025dd4e15bcbe765b2","tid":49345,"uid":6801,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T15:43:25.000Z","msg":"完全睇唔明點解要咁寫<img src=\"/assets/faces/normal/dead.gif\" class=\"hkgmoji\" /> <br />\n如果出黎係undefined behavior 咁寫黎做乜"},{"pid":"be1755ad475571b87ec3c92b5450426fa9475f08","tid":49345,"uid":34161,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T18:04:04.000Z","msg":"<blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n其實唔難解<br />\n<br />\n(*(int (*)())x)<span style=\"color: red;\">()</span>;<br />\n首先你見到最出右邊有開閂括號而又唔係包住成個 expression，咁就已經睇得出係 function call<br />\n入面冇嘢即係冇 parameter<br />\n<br />\n<span style=\"color: green;\">(</span><span style=\"color: red;\">*</span>(int (*)())x<span style=\"color: green;\">)</span><span style=\"color: pink;\">();</span><br />\n跟住左邊最出嘅括號入面係 unary operator *，即係 dereference pointer<br />\n<br />\n<span style=\"color: pink;\">(*<span style=\"color: green;\">(int (*)())[</span>red]x[/red])();</span><br />\n一個 variable / identifier 左邊有堆括住咗嘅嘢，就係一個 c-style cast<br />\n<br />\n<span style=\"color: pink;\">(*([black]int (*)()[/black])x)();</span><br />\ncast 做 function pointer returning int<br />\n<br />\n<a href=\"http://cdecl.org/?q=%28int+%28*%29%28%29%29x\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fcdecl.org%2F%3Fq%3D%2528int%2B%2528%2A%2529%2528%2529%2529x&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=e0e8c3ba\" target=\"_blank\">http://cdecl.org/?q=%28int+%28*%29%28%29%29x</a><br />\n<br />\n合埋就知成句做乜"},{"pid":"93d7b78faf5a2c762c6c89dc0d17b5aa3e3f6647","tid":49345,"uid":34161,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T18:05:15.000Z","msg":"<blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n其實唔難解<br />\n<br />\n(*(int (*)())x)<span style=\"color: red;\">()</span>;<br />\n首先你見到最出右邊有開閂括號而又唔係包住成個 expression，咁就已經睇得出係 function call<br />\n入面冇嘢即係冇 parameter<br />\n<br />\n<span style=\"color: green;\">(</span><span style=\"color: red;\">*</span>(int (*)())x<span style=\"color: green;\">)</span><span style=\"color: pink;\">();</span><br />\n跟住左邊最出嘅括號入面係 unary operator *，即係 dereference pointer<br />\n<br />\n<span style=\"color: pink;\">(*<span style=\"color: green;\">(int (*)())</span><span style=\"color: red;\">x</span>)();</span><br />\n一個 variable / identifier 左邊有堆括住咗嘅嘢，就係一個 c-style cast<br />\n<br />\n<span style=\"color: pink;\">(*(</span>int (*)()<span style=\"color: pink;\">)x)();</span><br />\ncast 做 function pointer returning int<br />\n<br />\n<a href=\"http://cdecl.org/?q=%28int+%28*%29%28%29%29x\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fcdecl.org%2F%3Fq%3D%2528int%2B%2528%2A%2529%2528%2529%2529x&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=e0e8c3ba\" target=\"_blank\">http://cdecl.org/?q=%28int+%28*%29%28%29%29x</a><br />\n<br />\n合埋就知成句做乜</blockquote><br />\n* formatting"},{"pid":"0c2748a37cf3089e73291245e7711bf97b937660","tid":49345,"uid":34161,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T18:06:40.000Z","msg":"<blockquote><blockquote><blockquote><blockquote><blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n(*(int (*)())x)();<br />\n啱啱試咗，我估我推論應該無錯<br />\nx係一個function，佢係cast緊一個function做咁樣 int f()，而因為cast緊嘅時候係唔用function name嘅，所以會有(*)。咁樣cast會cast到原本有argument(s)都變無，我估主要係咁，因為如果cast return value做int，唔需要cast得咁複雜，就咁cast個return咗value就得<br />\n不過我都唔清楚<br />\npastebin link就係我試咗嗰個，compile到咩問題都無，又run到<br />\n<a href=\"http://pastebin.com/3jEVNFgF\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fpastebin.com%2F3jEVNFgF&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=40014b4f\" target=\"_blank\">http://pastebin.com/3jEVNFgF</a></blockquote><br />\n<br />\n我試過就咁x()都run 到，點解？</blockquote><br />\n你有冇成段code？<br />\n就咁一句真係唔知想點</blockquote><br />\n#include &lt;iostream&gt;<br />\n<br />\nint foo()<br />\n{<br />\n    std::cout &lt;&lt; &quot;foo\\n&quot;;<br />\n    return 1;<br />\n}<br />\n<br />\nint main()<br />\n{<br />\n    void* fptr = (void*)&amp;::foo;<br />\n    <br />\n    // the following are equivalent<br />\n    ((int (*)())fptr)();<br />\n    (*(int (*)())fptr)();<br />\n}</blockquote><br />\n仲有點解((int (*)())fptr)()=(*(int (*)())fptr)()</blockquote><br />\n因為 function pointer 無論點 take reference 同 dereference 都係會出自己"},{"pid":"c26b4343d38b730faf6faf1f68448ecea13b9de2","tid":49345,"uid":43717,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T18:08:19.000Z","msg":"lm"},{"pid":"4721524036d3461526818c49f75acb10955eed88","tid":49345,"uid":34161,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T18:08:20.000Z","msg":"<blockquote>小心function pointer casting會係undefined behaviour</blockquote><br />\n一樣 type 咪唔係 <img src=\"/assets/faces/normal/smile.gif\" class=\"hkgmoji\" />"},{"pid":"4ae5d5944a81a393f4732a28e11cf9c5cbdaf9dc","tid":49345,"uid":34161,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T18:13:57.000Z","msg":"<blockquote>完全睇唔明點解要咁寫<img src=\"/assets/faces/normal/dead.gif\" class=\"hkgmoji\" /> <br />\n如果出黎係undefined behavior 咁寫黎做乜</blockquote><br />\n都係拎黎學下 function pointer 嘅 type signature同埋  reference/dereference 啫<br />\n有啲好似會拎黎教玩 run shellcode<br />\n但係如果本身對 assembly level 嘅運作冇認識嘅話，直接咁教係唔會明 <img src=\"/assets/faces/normal/donno.gif\" class=\"hkgmoji\" />"},{"pid":"24dcaa1e3fa11da3ad51bd9eec1a3dcc3c083a9d","tid":49345,"uid":34161,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-22T18:18:21.000Z","msg":"btw 如果係 c++ 大概可以等同咁寫 (應該係，用緊手機唔想 check<br />\n<br />\ntypedef int (*fptr_t)();<br />\n<br />\n(*reinterpret _cast&lt;fptr_t&gt;(x))();"},{"pid":"24ade1c929b3bc197faf14fcdbcc36134700e278","tid":49345,"uid":63156,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-23T01:35:53.000Z","msg":"咁又會有真實嘅應用嘅<br />\n有c library嘅callback係用void*嚟傳userdata<br />\n例如nghttp2<br />\n不過既然係c++點解要用function pointer唔用function object？"},{"pid":"36cb607ba1b688a60b5da5b8acbf5058288adbe3","tid":49345,"uid":67527,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-23T04:06:46.000Z","msg":"<blockquote><blockquote><blockquote><blockquote><blockquote>(*(int (*)())x)();<br />\n有無人知呢句點解？？拆左成晩都諗唔掂</blockquote><br />\n(*(int (*)())x)();<br />\n啱啱試咗，我估我推論應該無錯<br />\nx係一個function，佢係cast緊一個function做咁樣 int f()，而因為cast緊嘅時候係唔用function name嘅，所以會有(*)。咁樣cast會cast到原本有argument(s)都變無，我估主要係咁，因為如果cast return value做int，唔需要cast得咁複雜，就咁cast個return咗value就得<br />\n不過我都唔清楚<br />\npastebin link就係我試咗嗰個，compile到咩問題都無，又run到<br />\n<a href=\"http://pastebin.com/3jEVNFgF\" data-sr-url=\"https://r.lihkg.com/link?u=http%3A%2F%2Fpastebin.com%2F3jEVNFgF&d=DgJ1U%2FQ4SkTgvWt%2FEKlm%2B38C1RzHckko4WZAlj2iIrY%3D&h=40014b4f\" target=\"_blank\">http://pastebin.com/3jEVNFgF</a></blockquote><br />\n<br />\n我試過就咁x()都run 到，點解？</blockquote><br />\n你有冇成段code？<br />\n就咁一句真係唔知想點</blockquote><br />\n#include &lt;iostream&gt;<br />\n<br />\nint foo()<br />\n{<br />\n    std::cout &lt;&lt; &quot;foo\\n&quot;;<br />\n    return 1;<br />\n}<br />\n<br />\nint main()<br />\n{<br />\n    void* fptr = (void*)&amp;::foo;<br />\n    <br />\n    // the following are equivalent<br />\n    ((int (*)())fptr)();<br />\n    (*(int (*)())fptr)();<br />\n}</blockquote><br />\n成件事只係話個function pointer cast咗做一個普通pointer，之後用普通pointer call，要cast返做function先ok，所以用同一個signature cast返出嚟<img src=\"/assets/faces/normal/clown.gif\" class=\"hkgmoji\" />"},{"pid":"398c0e43f20e669907a46395ff737888b75eef2c","tid":49345,"uid":56377,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2016-12-23T04:20:36.000Z","msg":"<img src=\"/assets/faces/normal/kiss.gif\" class=\"hkgmoji\" />"}]}