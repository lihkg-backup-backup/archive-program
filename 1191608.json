{"tid":1191608,"cid":4,"subCid":0,"title":"寫在DC調光的浪潮開始之後","createTime":"2019-06-08T04:20:40.000Z","updateTime":"2019-06-08T07:09:14.000Z","uid":134437,"like":2,"dislike":2,"uniUserReply":3,"replies":[{"pid":"52f83a78a81029afad750117a44de6548bd8a030","tid":1191608,"uid":134437,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2019-06-08T04:20:40.000Z","msg":"魔法師蛋小丁<br />\n04.02 12:49<br />\n或者是重回正確的道路之前<br />\n<br />\n就像抽煙的人也想買空氣淨化器一樣，在顯示器和檯燈上都會追求低頻閃的我們卻一直以來對OLED屏的嚴重頻閃置若罔聞；<br />\n<br />\n<br />\n<br />\n而我無法忍受S8的頻閃，到今天引起大家都重視這個問題，經歷了兩年多的時間。<br />\n<br />\n<br />\n<br />\n剛開始提出這個問題的時候，大多數的聲音都是不友好的；直到做出類DC調光功能的內核，也有許多人嘲笑我為民科；<br />\n<br />\n但是從現在的大勢來看，我的目的已經達到了，以前的事情就不再贅述，至於什麼是PWM調光，PWM調光有什麼危害，現在網上也有很多資料，護眼燈的商品頁面也總會進行科普，有興趣的可以自己了解下，或者參考我的置頂微博。<br />\n<br />\n道阻且長行則將至<br />\n道阻且長行則將至<br />\n<br />\n<br />\n首先需要澄清的是，最早的手機OLED屏都是DC調光的，PWM調光反而是一個更複雜更&ldquo;先進&rdquo;的功能，因此不存在DC調光是誰&ldquo;發明&rdquo;的問題。<br />\n<br />\n<br />\n<br />\nPWM調光確實可以極大提升顏色的準確度，遮蓋Mura缺陷（你們所說的抹布屏）。<br />\n<br />\n<br />\n<br />\n模組廠商從良品率考慮，肯定不會做出廠全亮度DC調光的屏幕模組，PWM讓他們省了很多錢；而手機廠商從評測的結果考慮，也想在低亮度下通過PWM調光讓數據更好看（僅僅只是數據而已）。<br />\n<br />\n<br />\n<br />\n但用戶呢？這裡唯獨沒有用戶&hellip;&hellip;<br />\n<br />\n<br />\n<br />\n現在要解決的問題就是用戶的問題，讓用戶在使用手機更加舒適，而非看著手機屏幕評測數據自嗨。<br />\n<br />\n<br />\n<br />\n還有：DC調光並不會減少屏幕的壽命。反而電壓相同的情況下，PWM頻率越高，屏幕功耗越大，OLED衰減也越快。<br />\n<br />\n<br />\n<br />\n很多手機在大約100nit亮度以上是DC調光了，差不多是最高亮度的25%；但在系統UI的亮度進度條上，你要拉到70%以上，亮度才達到100nit。<br />\n<br />\n<br />\n<br />\n也就是說我們在室內使用手機時，基本上都是100nit以下亮度，&ldquo;享受&rdquo;240Hz的PWM調光。<br />\n<br />\n<br />\n<br />\n因此，問題的核心&mdash;&mdash;就是在100nit以下實現DC調光。<br />\n<br />\n<br />\n<br />\n在此之前，已經有一種叫做閃爍保護的APP在流行，它是通過強制屏幕高亮度，再應用一層灰色的圖層遮罩，來達到視覺上降低亮度的效果。<br />\n<br />\n<br />\n<br />\n但是這種思路對顯示效果的影響過於明顯，並且使用也不夠方便，我自己也嘗試使用過一段時間，後來還是放棄了。<br />\n<br />\n<br />\n<br />\n再之後，我想出了另外一個辦法，並首先在一加6T上做出了內核，這也是現在所有低亮度類DC調光功能的整體思路：<br />\n<br />\nXperia XZ3在各亮度下的頻閃曲線<br />\nXperia XZ3在各亮度下的頻閃曲線<br />\n<br />\n<br />\n以iXBT網站的Xperia XZ3測試結果為例，它在25%及以上亮度是DC調光，在10%亮度是低頻PWM調光。<br />\n<br />\n<br />\n<br />\n因此，我在內核中對系統亮度進行了判斷：<br />\n<br />\n&bull; 當收到信號，要求亮度低於25%的時候，內核就不管它了；無論接到什麼亮度請求，都強制系統亮度為25%，也就是說，即使你要調節亮度到10%，實際亮度也是25%；<br />\n<br />\n&bull; 之後通過高通MDP中的PCC功能，對屏幕收到的圖像亮度進行調整；也就是說這時候屏幕實際亮度沒變，就是25%，但是顯示的圖像變暗了，因此屏幕看起來也變暗了。<br />\n<br />\n<br />\n<br />\n這樣，在低亮度下既可以保持DC調光，也可以調節用戶的感官亮度。<br />\n<br />\n<br />\n<br />\nDC調光內核的軟件邏輯<br />\nDC調光內核的軟件邏輯<br />\n由於屏幕驅動芯片的一些寄存器目前不對外開放，不管是我這種第三方開發者，還是手機廠商都無法直接修改；所以，低亮度下的OLED屏幕是無法強制DC調光的（當然也有一種強行寫寄存器的魔改方法，但是最後的效果會很差）。<br />\n<br />\n<br />\n<br />\n綜上所述，目前手機廠商所使用的DC調光功能，都是類似的思路，不同的地方在於&ldquo;如何降低圖像亮度&rdquo;。<br />\n<br />\n對圖像亮度的降低方法，直接影響了低亮度下的顯示效果，例如從最簡單的應用遮罩（&ldquo;閃爍保護&rdquo;APP），到我嘗試調用高通MDP的PCC接口，再到硬件實現的Pixelworks顯示芯片。<br />\n<br />\n<br />\n<br />\n作為最早公開在微博上討論DC調光的廠商之一，OPPO的ColorOS雖然還沒有放出支持DC調光功能的測試版固件，但是跟他們對媒體開發團隊的工程師聊天的時候，他們提到更好的方法，對我也有很大的啟發。<br />\n<br />\n與ColorOS大佬的微信聊天截圖<br />\n與ColorOS大佬的微信聊天截圖<br />\n<br />\n<br />\n昨天，ColorOS的軟件負責人&mdash;&mdash;Jay，把他們做好的Demo視頻發出來了。<br />\n<br />\nvicon<br />\n<br />\n<br />\n<br />\n<br />\n我看了下Demo視頻，效果還是比較理想的；他們的工程師（多媒體開發團隊）後來還把原理圖發出來了，這里分析一下。<br />\n<br />\n<br />\n<br />\nDim Layer方案原理圖<br />\nDim Layer方案原理圖<br />\nColorOS做&ldquo;類DC調光&rdquo;，採用的是「蒙版調光」+「dither平滑」的方式。<br />\n<br />\n<br />\n<br />\n看到「蒙版調光」，很多人估計以為是閃爍保護那種應用蒙版；其實這裡的蒙版指的是驍龍855內部Snapdragon Display Engine的圖層混合器功能。<br />\n<br />\n<br />\n<br />\n這個混合器也用於處理VR的左右眼圖像，或者視頻解碼與應用界面的疊加等等；它有一個專用的圖層叫Dim Layer。<br />\n<br />\n<br />\n<br />\n圖層混合器通過對Dim Layer，與其它圖層進行透明混合處理，最終得到一個降低亮度後的輸出圖像；<br />\n<br />\n而我之前寫的PCC方案是針對合成後圖層的後期處理，相比較之下「蒙版調光」調用的接口更底層也更直接。<br />\n<br />\n<br />\n<br />\n他們的這種方法，在色階、對比度和色偏上，比PCC的方法都有提升，也與我在微博提到的&mdash;&mdash;用顏色抖動（dither）來解決色帶（banding）的思路，不謀而合。<br />\n<br />\n<br />\n<br />\n在無法改變硬件的情況下，這是比較理想的純軟件解決方案；從我的經驗來看，其他家的已發布或者未發布方案都還是基於PCC，而ColorOS 這套類DC調光方案，調用的接口更加巧妙，更加底層，不管是實際顯示效果還是功耗控制，優勢都是可預期的明顯勝出。<br />\n<br />\n<br />\n<br />\n從純軟件的角度來說，我認為未來低亮度類DC調光的方案，都會從PCC轉向他們這個方向；雖說技術難度並不高，但是思路的領先才是關鍵。<br />\n<br />\n<br />\n<br />\n在這裡，也感謝ColorOS 楊海等幾位的大力支持；說實話，肯把技術這樣講出來，還是很需要勇氣的；畢竟這是他們辛苦摸索的成果，這篇文章被關注我微博的友商看到之後，絕對會被拿去研究，大概率直接就用了。<br />\n<br />\n<br />\n<br />\n但是在交談中，他們還是很大度：如果友商用了我們的技術，能夠給消費者帶來更好的體驗，那就用了吧，算是OPPO 給業界帶來的一個小禮物。<br />\n<br />\n<br />\n<br />\n當然了，希望他們未來也用Pixelworks芯片加持，那就舒服了。<br />\n<br />\n<br />\n<br />\n經過這幾年永不為奴的抗爭，&ldquo;LCD教&rdquo;終於迎來了希望的曙光&mdash;&mdash;在DC調光的浪潮下終於不用擔心低頻PWM了。<br />\n<br />\n<br />\n<br />\n但是未來的路還很長：<br />\n<br />\n1，軟件調整圖像亮度，還需要探索更多的方法，更好地兼顧顯示效果與舒適度；<br />\n<br />\n2，隨著DC調光功能的普及，能否倒逼三星等OLED廠商做出全亮度DC調光的模組；<br />\n<br />\n3，能否進一步降低DC調光在每一幀刷新中的閃爍深度；<br />\n<br />\n4，能否做出720Hz甚至更高的高頻PWM調光OLED屏？<br />\n<br />\n<br />\n<br />\n這些需求是循序漸進的，但我們終於又走回了正確的道路；<br />\n<br />\n有了一個好的開始，幾千上萬塊錢的手機終於能像幾十一百塊錢的檯燈一樣，在資本​​野蠻生長的道路上考慮用戶的健康了。"},{"pid":"6c91761056c4cc0911410b21c9d53a22ff4891b5","tid":1191608,"uid":134437,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2019-06-08T04:21:01.000Z","msg":"<a href=\"https://media.weibo.cn/article?id=2309404356611547218397&amp;jumpfrom=weibocom\" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fmedia.weibo.cn%2Farticle%3Fid%3D2309404356611547218397%26jumpfrom%3Dweibocom&d=Bm7f%2FS52JQW29R4IancW8xIalbmCHUgENExjn%2BY9RKk%3D&h=21730cf6\" target=\"_blank\">https://media.weibo.cn/article?id=2309404356611547218397&amp;jumpfrom=weibocom</a>"},{"pid":"29542c1d37a1df64511d98efb5ffe349c1d371bd","tid":1191608,"uid":134437,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2019-06-08T04:23:27.000Z","msg":"<img src=\"/assets/faces/normal/smile.gif\" class=\"hkgmoji\" />"},{"pid":"e41aa7907a4e263831e3e5843126062bfa18838e","tid":1191608,"uid":61954,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-06-08T04:37:42.000Z","msg":"都係lcd好"},{"pid":"5d591032d6952c409c1c270b23313f13f2688b69","tid":1191608,"uid":43839,"like":0,"dislike":0,"score":0,"quote":{"pid":"e41aa7907a4e263831e3e5843126062bfa18838e","tid":1191608,"uid":61954,"like":1,"dislike":0,"score":1,"citedBy":1,"replyTime":"2019-06-08T04:37:42.000Z","msg":"都係lcd好"},"citedBy":0,"replyTime":"2019-06-08T07:09:14.000Z","msg":"LCD 有PWM 架<img src=\"/assets/faces/dog/haha.gif\" class=\"hkgmoji\" /><br />\n<br />\n上文都有講AMOLED 都有DC MODE 早期機<img src=\"/assets/faces/dog/smile.gif\" class=\"hkgmoji\" /><br />\n<br />\n係PWM ON9<img src=\"/assets/faces/dog/no.gif\" class=\"hkgmoji\" />"}]}