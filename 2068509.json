{"tid":2068509,"cid":26,"subCid":0,"title":"有關react 嘅野想問一問","createTime":"2020-06-17T17:40:45.000Z","updateTime":"2020-06-21T01:16:51.000Z","uid":157970,"like":1,"dislike":1,"uniUserReply":17,"replies":[{"pid":"fa1513fda7e97ded2f2e051fc5e591412af20b23","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-17T17:40:45.000Z","msg":"寫react 嘅時候啲同事都好中意喺setState前面加await，例如：<br />\n<pre><code data-type=\"javascript\">async componentDidMount () {\n    console.log(this.state) // { a: &quot;foo&quot; }\n    await this.setState({ a: &quot;bar&quot; })\n    console.log(this.state) // { a: &quot;bar&quot; }\n} </code></pre> <br />\ntypescript 會出<br />\n<pre><code data-type=\"\">'await' has no effect on the type of this expression.ts(80007)</code></pre><br />\n但實際上個await 的確有影響<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" />, 下面係個解釋<br />\n<a href=\"https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate \" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F47019199%2Fwhy-does-async-await-work-with-react-setstate%20&d=u0uYB5UElWTGJsHKTdw4wZ4O1D3QR3Td9ugMDSJ%2BOB4%3D&h=e87cbe1b\" target=\"_blank\">https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate </a><br />\n大概就係event queue 入面個undefined 會放咗喺setState updater嘅後面<br />\n雖然睇落好似亂咁黎好唔順眼，但係又真係work，諗唔到幾時會fail <img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n應唔應該由得佢地繼續咁寫好<img src=\"/assets/faces/lm2/wonder2.gif\" class=\"hkgmoji\" />"},{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},{"pid":"3fa6f5611fa9e6cee72ce6f70244d4a819e882ce","tid":2068509,"uid":157970,"like":1,"dislike":0,"score":1,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":3,"replyTime":"2020-06-17T18:09:00.000Z","msg":"將個state 放去useEffect 個 dependency array"},{"pid":"afef4a87bfafb450119c6d6f42243d7f1d4ad226","tid":2068509,"uid":23094,"like":1,"dislike":1,"score":0,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":1,"replyTime":"2020-06-17T18:09:24.000Z","msg":"State hook好似冇callback？<br />\nFunctional componet自己都唔知自己完成Rendering未<br />\n應該冇安全做法"},{"pid":"a20281d6976c53a4d85f016e45693488dfb4a4df","tid":2068509,"uid":23094,"like":0,"dislike":0,"score":0,"quote":{"pid":"3fa6f5611fa9e6cee72ce6f70244d4a819e882ce","tid":2068509,"uid":157970,"like":1,"dislike":0,"score":1,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":3,"replyTime":"2020-06-17T18:09:00.000Z","msg":"將個state 放去useEffect 個 dependency array"},"citedBy":0,"replyTime":"2020-06-17T18:10:44.000Z","msg":"<img src=\"/assets/faces/lm2/bang.gif\" class=\"hkgmoji\" />"},{"pid":"6622386a8b12706d865e8f5166d2e31e713e2baf","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"3fa6f5611fa9e6cee72ce6f70244d4a819e882ce","tid":2068509,"uid":157970,"like":1,"dislike":0,"score":1,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":3,"replyTime":"2020-06-17T18:09:00.000Z","msg":"將個state 放去useEffect 個 dependency array"},"citedBy":2,"replyTime":"2020-06-17T18:12:04.000Z","msg":"我意思係想asyncSetState 咁寫，hooks 個setState冇左callback, 冇得resolve，有冇得寫一個setState又可以resolve"},{"pid":"57d16b4a76b9d0be968e7adafa63c46a3c79f28f","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"quote":{"pid":"6622386a8b12706d865e8f5166d2e31e713e2baf","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"3fa6f5611fa9e6cee72ce6f70244d4a819e882ce","tid":2068509,"uid":157970,"like":1,"dislike":0,"score":1,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":3,"replyTime":"2020-06-17T18:09:00.000Z","msg":"將個state 放去useEffect 個 dependency array"},"citedBy":2,"replyTime":"2020-06-17T18:12:04.000Z","msg":"我意思係想asyncSetState 咁寫，hooks 個setState冇左callback, 冇得resolve，有冇得寫一個setState又可以resolve"},"citedBy":0,"replyTime":"2020-06-17T18:30:56.000Z","msg":"暫時諗唔到<img src=\"/assets/faces/normal/frown.gif\" class=\"hkgmoji\" /><br />\nmaybe 可以整個custom hook 裝住個state 同callback function，<br />\n然後再用Promise wrap住佢<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n咁搞我不如用返useEffect 算，簡單又易用"},{"pid":"5565c61809814d9dba13bf7eec474e1513d452a8","tid":2068509,"uid":67527,"like":5,"dislike":0,"score":5,"citedBy":0,"replyTime":"2020-06-17T20:49:22.000Z","msg":"其實做咩要await setState/setX for hook? 我從來都冇需要等佢之後做嘢，不過我好耐冇寫react"},{"pid":"983becca820c4dbfa2c0e3cdfa70cac6839f5e8e","tid":2068509,"uid":255967,"like":4,"dislike":0,"score":4,"citedBy":2,"replyTime":"2020-06-17T20:55:42.000Z","msg":"async setstate 根本唔係clean 既寫法<br />\nasync logic 不如用redux-saga<br />\nasync logic同component 應該分開黎放<br />\n<br />\n簡單async 用useeffect 都ok <br />\n<br />\n但call 一次api 己經有3個setstate<br />\nconst [countries, setCountries] = useState([]);<br />\n    const [load, setLoad] = useState(false);<br />\n    const [error, setError] = useState('');<br />\n個logic 係call 幾個api 己經好大舊<br />\n咁不如一開始async 同component 分開"},{"pid":"69d0680366f5b4689a569b9811e926cc81916a5f","tid":2068509,"uid":255967,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2020-06-17T21:08:00.000Z","msg":"同埋用useeffect 間接要你用createContext<br />\n即係迫你用 functional component<br />\n呢一點我個人唔太鍾意<img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" /><br />\n<br />\n例子.<br />\n<a href=\"https://github.com/auth0-samples/auth0-react-samples/blob/master/01-Login/src/components/PrivateRoute.js\" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fgithub.com%2Fauth0-samples%2Fauth0-react-samples%2Fblob%2Fmaster%2F01-Login%2Fsrc%2Fcomponents%2FPrivateRoute.js&d=u0uYB5UElWTGJsHKTdw4wZ4O1D3QR3Td9ugMDSJ%2BOB4%3D&h=0bda9f6c\" target=\"_blank\">https://github.com/auth0-samples/auth0-react-samples/blob/master/01-Login/src/components/PrivateRoute.js</a><br />\n<br />\n<a href=\"https://github.com/auth0-samples/auth0-react-samples/blob/master/01-Login/src/react-auth0-spa.js\" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fgithub.com%2Fauth0-samples%2Fauth0-react-samples%2Fblob%2Fmaster%2F01-Login%2Fsrc%2Freact-auth0-spa.js&d=u0uYB5UElWTGJsHKTdw4wZ4O1D3QR3Td9ugMDSJ%2BOB4%3D&h=e72d0eab\" target=\"_blank\">https://github.com/auth0-samples/auth0-react-samples/blob/master/01-Login/src/react-auth0-spa.js</a>"},{"pid":"18d47690ca5a27127dfd0b2ce9b4fa96141a336c","tid":2068509,"uid":67527,"like":2,"dislike":0,"score":2,"quote":{"pid":"983becca820c4dbfa2c0e3cdfa70cac6839f5e8e","tid":2068509,"uid":255967,"like":4,"dislike":0,"score":4,"citedBy":2,"replyTime":"2020-06-17T20:55:42.000Z","msg":"async setstate 根本唔係clean 既寫法<br />\nasync logic 不如用redux-saga<br />\nasync logic同component 應該分開黎放<br />\n<br />\n簡單async 用useeffect 都ok <br />\n<br />\n但call 一次api 己經有3個setstate<br />\nconst [countries, setCountries] = useState([]);<br />\n    const [load, setLoad] = useState(false);<br />\n    const [error, setError] = useState('');<br />\n個logic 係call 幾個api 己經好大舊<br />\n咁不如一開始async 同component 分開"},"citedBy":0,"replyTime":"2020-06-17T22:46:09.000Z","msg":"啱啊，根本應該分開放，Component嘅state只應該關於UI，business logic根本唔應該放落去，只要唔放business logic落去，其實冇咩機會要等個setState"},{"pid":"af9c0a6303391a717d89225140f800327f5c9376","tid":2068509,"uid":50910,"like":0,"dislike":0,"score":0,"quote":{"pid":"afef4a87bfafb450119c6d6f42243d7f1d4ad226","tid":2068509,"uid":23094,"like":1,"dislike":1,"score":0,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":1,"replyTime":"2020-06-17T18:09:24.000Z","msg":"State hook好似冇callback？<br />\nFunctional componet自己都唔知自己完成Rendering未<br />\n應該冇安全做法"},"citedBy":0,"replyTime":"2020-06-18T00:20:29.000Z","msg":"<pre><code data-type=\"\">const [state , setState ] = useState(0);\n\nuseEffect(()=&gt;{\n   console.log(&lsquo; New state is ${state}&rsquo;);\n},[state])</code></pre>"},{"pid":"77825dd564c412c82a3932e62a3487ac6868cceb","tid":2068509,"uid":23953,"like":1,"dislike":0,"score":1,"quote":{"pid":"6622386a8b12706d865e8f5166d2e31e713e2baf","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"3fa6f5611fa9e6cee72ce6f70244d4a819e882ce","tid":2068509,"uid":157970,"like":1,"dislike":0,"score":1,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":3,"replyTime":"2020-06-17T18:09:00.000Z","msg":"將個state 放去useEffect 個 dependency array"},"citedBy":2,"replyTime":"2020-06-17T18:12:04.000Z","msg":"我意思係想asyncSetState 咁寫，hooks 個setState冇左callback, 冇得resolve，有冇得寫一個setState又可以resolve"},"citedBy":0,"replyTime":"2020-06-18T00:54:53.000Z","msg":"react 唔support async render<br />\n放棄啦"},{"pid":"fd34654a6c1547d6f25d57abf34b7219a1d9b3a1","tid":2068509,"uid":79869,"like":2,"dislike":0,"score":2,"quote":{"pid":"fa1513fda7e97ded2f2e051fc5e591412af20b23","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-17T17:40:45.000Z","msg":"寫react 嘅時候啲同事都好中意喺setState前面加await，例如：<br />\n<pre><code data-type=\"javascript\">async componentDidMount () {\n    console.log(this.state) // { a: &quot;foo&quot; }\n    await this.setState({ a: &quot;bar&quot; })\n    console.log(this.state) // { a: &quot;bar&quot; }\n} </code></pre> <br />\ntypescript 會出<br />\n<pre><code data-type=\"\">'await' has no effect on the type of this expression.ts(80007)</code></pre><br />\n但實際上個await 的確有影響<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" />, 下面係個解釋<br />\n<a href=\"https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate \" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F47019199%2Fwhy-does-async-await-work-with-react-setstate%20&d=u0uYB5UElWTGJsHKTdw4wZ4O1D3QR3Td9ugMDSJ%2BOB4%3D&h=e87cbe1b\" target=\"_blank\">https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate </a><br />\n大概就係event queue 入面個undefined 會放咗喺setState updater嘅後面<br />\n雖然睇落好似亂咁黎好唔順眼，但係又真係work，諗唔到幾時會fail <img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n應唔應該由得佢地繼續咁寫好<img src=\"/assets/faces/lm2/wonder2.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2020-06-18T01:30:41.000Z","msg":"如果你有睇stackoverflow入面既解釋<br />\nawait起作用只係剛好佢排左個event係event loop後面<br />\n即係話只要你setState入面故意再call幾個async...<br />\n成個async chain就會亂左<br />\n完全guarantee唔到d咩"},{"pid":"7bed03a028bef2ddc64f28c0789fa779d26f19d3","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"quote":{"pid":"fd34654a6c1547d6f25d57abf34b7219a1d9b3a1","tid":2068509,"uid":79869,"like":2,"dislike":0,"score":2,"quote":{"pid":"fa1513fda7e97ded2f2e051fc5e591412af20b23","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-17T17:40:45.000Z","msg":"寫react 嘅時候啲同事都好中意喺setState前面加await，例如：<br />\n<pre><code data-type=\"javascript\">async componentDidMount () {\n    console.log(this.state) // { a: &quot;foo&quot; }\n    await this.setState({ a: &quot;bar&quot; })\n    console.log(this.state) // { a: &quot;bar&quot; }\n} </code></pre> <br />\ntypescript 會出<br />\n<pre><code data-type=\"\">'await' has no effect on the type of this expression.ts(80007)</code></pre><br />\n但實際上個await 的確有影響<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" />, 下面係個解釋<br />\n<a href=\"https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate \" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F47019199%2Fwhy-does-async-await-work-with-react-setstate%20&d=u0uYB5UElWTGJsHKTdw4wZ4O1D3QR3Td9ugMDSJ%2BOB4%3D&h=e87cbe1b\" target=\"_blank\">https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate </a><br />\n大概就係event queue 入面個undefined 會放咗喺setState updater嘅後面<br />\n雖然睇落好似亂咁黎好唔順眼，但係又真係work，諗唔到幾時會fail <img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n應唔應該由得佢地繼續咁寫好<img src=\"/assets/faces/lm2/wonder2.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2020-06-18T01:30:41.000Z","msg":"如果你有睇stackoverflow入面既解釋<br />\nawait起作用只係剛好佢排左個event係event loop後面<br />\n即係話只要你setState入面故意再call幾個async...<br />\n成個async chain就會亂左<br />\n完全guarantee唔到d咩"},"citedBy":2,"replyTime":"2020-06-18T02:22:46.000Z","msg":"但係個問題係就咁用await this.setState({ ... }) 嘅話冇問題...<br />\n同事話行到就得<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n我而家要諗個原因叫佢地唔好咁寫"},{"pid":"09d7cb861c7488c69647031a8ce7c74b84499164","tid":2068509,"uid":32650,"like":0,"dislike":0,"score":0,"quote":{"pid":"7bed03a028bef2ddc64f28c0789fa779d26f19d3","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"quote":{"pid":"fd34654a6c1547d6f25d57abf34b7219a1d9b3a1","tid":2068509,"uid":79869,"like":2,"dislike":0,"score":2,"quote":{"pid":"fa1513fda7e97ded2f2e051fc5e591412af20b23","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-17T17:40:45.000Z","msg":"寫react 嘅時候啲同事都好中意喺setState前面加await，例如：<br />\n<pre><code data-type=\"javascript\">async componentDidMount () {\n    console.log(this.state) // { a: &quot;foo&quot; }\n    await this.setState({ a: &quot;bar&quot; })\n    console.log(this.state) // { a: &quot;bar&quot; }\n} </code></pre> <br />\ntypescript 會出<br />\n<pre><code data-type=\"\">'await' has no effect on the type of this expression.ts(80007)</code></pre><br />\n但實際上個await 的確有影響<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" />, 下面係個解釋<br />\n<a href=\"https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate \" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F47019199%2Fwhy-does-async-await-work-with-react-setstate%20&d=u0uYB5UElWTGJsHKTdw4wZ4O1D3QR3Td9ugMDSJ%2BOB4%3D&h=e87cbe1b\" target=\"_blank\">https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate </a><br />\n大概就係event queue 入面個undefined 會放咗喺setState updater嘅後面<br />\n雖然睇落好似亂咁黎好唔順眼，但係又真係work，諗唔到幾時會fail <img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n應唔應該由得佢地繼續咁寫好<img src=\"/assets/faces/lm2/wonder2.gif\" class=\"hkgmoji\" />"},"citedBy":1,"replyTime":"2020-06-18T01:30:41.000Z","msg":"如果你有睇stackoverflow入面既解釋<br />\nawait起作用只係剛好佢排左個event係event loop後面<br />\n即係話只要你setState入面故意再call幾個async...<br />\n成個async chain就會亂左<br />\n完全guarantee唔到d咩"},"citedBy":2,"replyTime":"2020-06-18T02:22:46.000Z","msg":"但係個問題係就咁用await this.setState({ ... }) 嘅話冇問題...<br />\n同事話行到就得<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n我而家要諗個原因叫佢地唔好咁寫"},"citedBy":1,"replyTime":"2020-06-18T03:14:40.000Z","msg":"點解唔係await 完個event 先 setState ? <br />\n<br />\nsetLoading(true)<br />\nconst result = await doSomething();<br />\nif(!result){<br />\n    setLoading(false);<br />\n    setError(true);<br />\n    return;<br />\n}<br />\nsetResult(result)<br />\nsetLoading(false)"},{"pid":"e4f831789410ae0ab6c811c13902c0433f6841d9","tid":2068509,"uid":157970,"like":0,"dislike":2,"score":-2,"quote":{"pid":"09d7cb861c7488c69647031a8ce7c74b84499164","tid":2068509,"uid":32650,"like":0,"dislike":0,"score":0,"quote":{"pid":"7bed03a028bef2ddc64f28c0789fa779d26f19d3","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"quote":{"pid":"fd34654a6c1547d6f25d57abf34b7219a1d9b3a1","tid":2068509,"uid":79869,"like":2,"dislike":0,"score":2,"citedBy":1,"replyTime":"2020-06-18T01:30:41.000Z","msg":"如果你有睇stackoverflow入面既解釋<br />\nawait起作用只係剛好佢排左個event係event loop後面<br />\n即係話只要你setState入面故意再call幾個async...<br />\n成個async chain就會亂左<br />\n完全guarantee唔到d咩"},"citedBy":2,"replyTime":"2020-06-18T02:22:46.000Z","msg":"但係個問題係就咁用await this.setState({ ... }) 嘅話冇問題...<br />\n同事話行到就得<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n我而家要諗個原因叫佢地唔好咁寫"},"citedBy":1,"replyTime":"2020-06-18T03:14:40.000Z","msg":"點解唔係await 完個event 先 setState ? <br />\n<br />\nsetLoading(true)<br />\nconst result = await doSomething();<br />\nif(!result){<br />\n    setLoading(false);<br />\n    setError(true);<br />\n    return;<br />\n}<br />\nsetResult(result)<br />\nsetLoading(false)"},"citedBy":4,"replyTime":"2020-06-18T03:33:33.000Z","msg":"佢地已經唔係await 一個event <img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" /><br />\n單純係發現個setState係async<br />\n想喺setState之後馬上用新嘅state所以加await<br />\n<pre><code data-type=\"javascript\">this.setState(newState)\ndoSthWithNewState(this.state) // not yet updated</code></pre>"},{"pid":"3f8e50d0ec01268c5b213770ba7b0326c9dadfc3","tid":2068509,"uid":41204,"like":0,"dislike":0,"score":0,"quote":{"pid":"3fa6f5611fa9e6cee72ce6f70244d4a819e882ce","tid":2068509,"uid":157970,"like":1,"dislike":0,"score":1,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"quote":{"pid":"8eb365204092e00b5b6d407be924687586c195d4","tid":2068509,"uid":23094,"like":7,"dislike":0,"score":7,"citedBy":1,"replyTime":"2020-06-17T18:03:28.000Z","msg":"咁樣安全啲<br />\n<br />\n<pre><code data-type=\"\">async componentDidMount () {\n  console.log(this.state); // { a: 'foo' }\n  await this.asyncSetState({ a: 'bar' });\n  console.log(this.state); // { a: 'bar' }\n}\n\nasyncSetState (state) {\n  return new Promise((resolve) =&gt; {\n    this.setState(state, resolve);\n  });\n}</code></pre>"},"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":3,"replyTime":"2020-06-17T18:09:00.000Z","msg":"將個state 放去useEffect 個 dependency array"},"citedBy":1,"replyTime":"2020-06-18T03:52:37.000Z","msg":"咁咪無限loop"},{"pid":"a4e49ed8e947e97a2d84fbf4ec9ff2a19ee29f52","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"quote":{"pid":"3f8e50d0ec01268c5b213770ba7b0326c9dadfc3","tid":2068509,"uid":41204,"like":0,"dislike":0,"score":0,"quote":{"pid":"3fa6f5611fa9e6cee72ce6f70244d4a819e882ce","tid":2068509,"uid":157970,"like":1,"dislike":0,"score":1,"quote":{"pid":"2dda0f72d5d4aaf5d936c78f64e18cf11c724fe0","tid":2068509,"uid":259544,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-17T18:05:40.000Z","msg":"如果functional component hooks 可以點寫<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />?"},"citedBy":3,"replyTime":"2020-06-17T18:09:00.000Z","msg":"將個state 放去useEffect 個 dependency array"},"citedBy":1,"replyTime":"2020-06-18T03:52:37.000Z","msg":"咁咪無限loop"},"citedBy":0,"replyTime":"2020-06-18T04:07:09.000Z","msg":"點樣無限loop法?<br />\n求教學<img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /><img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" /><img src=\"/assets/faces/normal/adore.gif\" class=\"hkgmoji\" />"},{"pid":"c163df15ceede215a8ba2e8147a918647909a73a","tid":2068509,"uid":23953,"like":0,"dislike":0,"score":0,"quote":{"pid":"e4f831789410ae0ab6c811c13902c0433f6841d9","tid":2068509,"uid":157970,"like":0,"dislike":2,"score":-2,"quote":{"pid":"09d7cb861c7488c69647031a8ce7c74b84499164","tid":2068509,"uid":32650,"like":0,"dislike":0,"score":0,"quote":{"pid":"7bed03a028bef2ddc64f28c0789fa779d26f19d3","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-18T02:22:46.000Z","msg":"但係個問題係就咁用await this.setState({ ... }) 嘅話冇問題...<br />\n同事話行到就得<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n我而家要諗個原因叫佢地唔好咁寫"},"citedBy":1,"replyTime":"2020-06-18T03:14:40.000Z","msg":"點解唔係await 完個event 先 setState ? <br />\n<br />\nsetLoading(true)<br />\nconst result = await doSomething();<br />\nif(!result){<br />\n    setLoading(false);<br />\n    setError(true);<br />\n    return;<br />\n}<br />\nsetResult(result)<br />\nsetLoading(false)"},"citedBy":4,"replyTime":"2020-06-18T03:33:33.000Z","msg":"佢地已經唔係await 一個event <img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" /><br />\n單純係發現個setState係async<br />\n想喺setState之後馬上用新嘅state所以加await<br />\n<pre><code data-type=\"javascript\">this.setState(newState)\ndoSthWithNewState(this.state) // not yet updated</code></pre>"},"citedBy":0,"replyTime":"2020-06-18T05:17:28.000Z","msg":"用返promise寫就一清二楚"},{"pid":"0031154d32eac64f5d5349972beebc7aea8f4ba5","tid":2068509,"uid":32650,"like":0,"dislike":0,"score":0,"quote":{"pid":"e4f831789410ae0ab6c811c13902c0433f6841d9","tid":2068509,"uid":157970,"like":0,"dislike":2,"score":-2,"quote":{"pid":"09d7cb861c7488c69647031a8ce7c74b84499164","tid":2068509,"uid":32650,"like":0,"dislike":0,"score":0,"quote":{"pid":"7bed03a028bef2ddc64f28c0789fa779d26f19d3","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-18T02:22:46.000Z","msg":"但係個問題係就咁用await this.setState({ ... }) 嘅話冇問題...<br />\n同事話行到就得<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n我而家要諗個原因叫佢地唔好咁寫"},"citedBy":1,"replyTime":"2020-06-18T03:14:40.000Z","msg":"點解唔係await 完個event 先 setState ? <br />\n<br />\nsetLoading(true)<br />\nconst result = await doSomething();<br />\nif(!result){<br />\n    setLoading(false);<br />\n    setError(true);<br />\n    return;<br />\n}<br />\nsetResult(result)<br />\nsetLoading(false)"},"citedBy":4,"replyTime":"2020-06-18T03:33:33.000Z","msg":"佢地已經唔係await 一個event <img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" /><br />\n單純係發現個setState係async<br />\n想喺setState之後馬上用新嘅state所以加await<br />\n<pre><code data-type=\"javascript\">this.setState(newState)\ndoSthWithNewState(this.state) // not yet updated</code></pre>"},"citedBy":0,"replyTime":"2020-06-18T05:50:15.000Z","msg":"setLoading(true)<br />\nconst result = await doSomething();<br />\nif(!result){<br />\nsetLoading(false);<br />\nsetError(true);<br />\nreturn;<br />\n}<br />\nawait doSomethingWithNewState(result)<br />\nsetResult(result)<br />\nsetLoading(false)"},{"pid":"45e3a7afaadd2ce5a1579b2700d7b51ba7aef45b","tid":2068509,"uid":255967,"like":4,"dislike":0,"score":4,"quote":{"pid":"e4f831789410ae0ab6c811c13902c0433f6841d9","tid":2068509,"uid":157970,"like":0,"dislike":2,"score":-2,"quote":{"pid":"09d7cb861c7488c69647031a8ce7c74b84499164","tid":2068509,"uid":32650,"like":0,"dislike":0,"score":0,"quote":{"pid":"7bed03a028bef2ddc64f28c0789fa779d26f19d3","tid":2068509,"uid":157970,"like":0,"dislike":0,"score":0,"citedBy":2,"replyTime":"2020-06-18T02:22:46.000Z","msg":"但係個問題係就咁用await this.setState({ ... }) 嘅話冇問題...<br />\n同事話行到就得<img src=\"/assets/faces/lm2/haha.gif\" class=\"hkgmoji\" /><br />\n我而家要諗個原因叫佢地唔好咁寫"},"citedBy":1,"replyTime":"2020-06-18T03:14:40.000Z","msg":"點解唔係await 完個event 先 setState ? <br />\n<br />\nsetLoading(true)<br />\nconst result = await doSomething();<br />\nif(!result){<br />\n    setLoading(false);<br />\n    setError(true);<br />\n    return;<br />\n}<br />\nsetResult(result)<br />\nsetLoading(false)"},"citedBy":4,"replyTime":"2020-06-18T03:33:33.000Z","msg":"佢地已經唔係await 一個event <img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" /><br />\n單純係發現個setState係async<br />\n想喺setState之後馬上用新嘅state所以加await<br />\n<pre><code data-type=\"javascript\">this.setState(newState)\ndoSthWithNewState(this.state) // not yet updated</code></pre>"},"citedBy":0,"replyTime":"2020-06-18T05:51:32.000Z","msg":"唔明<br />\n<br />\nsetstate 第二個param 係callback 黎<br />\n直接用佢唔得？"},{"pid":"548c4783a730c046c7ea5a29c12fac173e21bb50","tid":2068509,"uid":3441,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2020-06-18T05:55:32.000Z","msg":"好似12樓咁講refactor算啦。"},{"pid":"bf9973ec462c110cc059e47cdb1153dd5a3dafc6","tid":2068509,"uid":124400,"like":2,"dislike":0,"score":2,"citedBy":0,"replyTime":"2020-06-18T06:07:30.000Z","msg":"<pre><code data-type=\"\">  const [a, setA] = useState('foo');\n\n  useEffect(() =&gt; {\n    setA('bar');\n  }, []);\n\n  useEffect(() =&gt; {\n    console.log(a);\n  }, [a]);</code></pre>"}]}