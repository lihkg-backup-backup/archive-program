{"tid":443397,"cid":26,"subCid":0,"title":"MacOS High Sierra 發現漏洞，任何人都可以輕易使系統死機","createTime":"2017-10-21T14:23:44.000Z","updateTime":"2017-10-22T04:56:10.000Z","uid":1886,"like":1,"dislike":0,"uniUserReply":6,"replies":[{"pid":"69b5c6d28067a427e480cd189d6115c26071aa83","tid":443397,"uid":1886,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-21T14:23:44.000Z","msg":"<div style=\"text-align: center;\"><img src=\"https://img.technews.tw/wp-content/uploads/2017/09/27163115/macOS-High-Sierra-01-1-624x281.jpg\" data-thumbnail-src=\"https://i.lih.kg/thumbnail?u=https%3A%2F%2Fimg.technews.tw%2Fwp-content%2Fuploads%2F2017%2F09%2F27163115%2FmacOS-High-Sierra-01-1-624x281.jpg&h=761882e9&s={SIZE}\" /></div><br />\n<br />\n一位開放原碼開發者 Shea Levy 向 Apple 通報最新的電腦作業系統 MacOS High Sierra 有一個天大的漏洞<img src=\"/assets/faces/normal/bye.gif\" class=\"hkgmoji\" /> ──任何沒有特權的使用者帳號都可以下 kill -1 指令癱瘓整個系統，使系統當機無法操作<img src=\"/assets/faces/normal/sosad.gif\" class=\"hkgmoji\" /> 。意思是說，如果你到蘋果電腦的展場，任何人都可以輕易使展示的蘋果電腦死機<img src=\"/assets/faces/normal/tongue.gif\" class=\"hkgmoji\" /> <img src=\"/assets/faces/normal/tongue.gif\" class=\"hkgmoji\" /> 。<br />\n<br />\n<div style=\"text-align: center;\">全文：<br />\n<a href=\"https://technews.tw/2017/10/20/privilege-escalation-with-kill-1-sigkill-in-xnu-kernel-of-macos-high-sierra/\" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Ftechnews.tw%2F2017%2F10%2F20%2Fprivilege-escalation-with-kill-1-sigkill-in-xnu-kernel-of-macos-high-sierra%2F&d=tw3nUCv8RbJwr0cd%2BjhLKgKEmdudW1rq3V1Y15kzxIU%3D&h=904755cc\" target=\"_blank\">https://technews.tw/2017/10/20/privilege-escalation-with-kill-1-sigkill-in-xnu-kernel-of-macos-high-sierra/</a></div>"},{"pid":"a5c22b4514152a07151bf1c4e0f89ea6a7c72806","tid":443397,"uid":1886,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-21T14:24:14.000Z","msg":"事情是這樣的，一開始是另外一位開源開發者 Matthew Bauer 在 MacOS High Sierra 系統使用 NixOS 這套開放原碼的套件管理程式時，發現會莫名其妙瞬間系統完全凍結，無法控制，於是提報這個狀況。許多人開始追查原因，一開始以為是 NixOS 自己的錯誤，然而追蹤到一個地方，就是 NixOS 在 build（從原始碼自動編譯成可執行檔的程序）App 時，NixOS 會使用一個低權限使用者帳號來 build，當該低權限帳號的工作都完成後，會下系統呼叫 syscall(SYS_kill, -1, SIGKILL, 0) 來清除該帳號所有行程（process）結束作業， 然而沒想到整個系統不管哪個使用者的行程都會一起刪除。"},{"pid":"5ba022beba52fb192caad43a3bf425b0212e5fc9","tid":443397,"uid":1886,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-21T14:24:32.000Z","msg":"Shea Levy 提供以下的 C 語言範例：<br />\n<br />\ntest.c:<br />\n<br />\n#include &lt;unistd.h&gt;<br />\n#include &lt;sys/syscall.h&gt;<br />\n#include &lt;signal.h&gt;<br />\n#include &lt;errno.h&gt;<br />\n#include &lt;string.h&gt;<br />\n#include &lt;stdio.h&gt;<br />\n<br />\nint main() {<br />\nint result;<br />\n<br />\nfor (int i = 0; i &lt; 200; i++) {<br />\nresult = kill(-1, SIGKILL); // Also fails with <code>syscall(SYS_kill, -1, SIGKILL, 0);</code><br />\nprintf(&ldquo;result:%i,errno:%i (%s)\\n&quot;, result, errno, strerror(errno));<br />\n}<br />\n}<br />\n<br />\n$ gcc test.c<br />\n$ sudo -i<br />\n# /usr/bin/sysadminctl -addUser -fullName &ldquo;Kill Test User&quot; -home /var/empty -addUser killtest<br />\n# cd /<br />\n# while true; do sudo -u killtest /bin/sh -c &ldquo;sleep 1 &amp; ./a.out&rdquo;; done<br />\n<br />\n只要花大概幾分鐘的時間，就可以讓你的系統當機。另外還有 bash 命令稿版本如下：<br />\n<br />\n$ sudo /usr/bin/sysadminctl -addUser -fullName &ldquo;Kill Test User&quot; -home /var/empty -addUser killtest<br />\n$ while true; do sudo -u killtest /bin/sh -c &ldquo;sleep 1 &amp; kill -kill -1&rdquo;; done"},{"pid":"3f82ca83eeec83e1fb9fce709800dad4659ea04a","tid":443397,"uid":1886,"like":2,"dislike":0,"score":2,"citedBy":0,"replyTime":"2017-10-21T14:25:25.000Z","msg":"更進一步追查，另外一位程式設計師 Daniel Peebles 發現根本不用那麼麻煩，只要簡單使用 libc 的 kill 呼叫，還有 kill 系統指令，就可以輕鬆當掉整個系統，問題出在 MacOS High Sierra 系統核心 XNU kernel。<br />\n<br />\n於是 Shea Levy 等人不但通報 NixOS 團隊，還通報蘋果公司，然而卻得到蘋果公司如此回應：「 We have not reserved a CVE for this issue as Apple is a CNA and does not see it as a security issue.」意思是說蘋果不認為這是一個安全性問題，所以不打算發一個 CVE（Common Vulnerabilities and Exposures，常見漏洞與暴露弱點 ）編號給這個問題<img src=\"/assets/faces/normal/surprise.gif\" class=\"hkgmoji\" /> <img src=\"/assets/faces/normal/surprise.gif\" class=\"hkgmoji\" /> 。<br />\n<br />\n是的，這是 local 端實體電腦的漏洞，而不是現在大家比較關注的網路漏洞，看似沒啥大不了，然而試想，除了你可在蘋果電腦商場把展示電腦弄當機，如果你看使用蘋果電腦的同學、同事不爽，就可以趁他離開座位不在時，輕易讓他目前的心血瞬間付之東流，而這到底算不算安全問題呢？"},{"pid":"3d0e7cbe25c10466788477fa8cdc21100289438f","tid":443397,"uid":1886,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-21T14:25:41.000Z","msg":"<a href=\"https://groups.google.com/forum/m/#!topic/nix-devel/KV9eomIdxWE\" data-sr-url=\"https://r.lihkg.com/link?u=https%3A%2F%2Fgroups.google.com%2Fforum%2Fm%2F%23%21topic%2Fnix-devel%2FKV9eomIdxWE&d=tw3nUCv8RbJwr0cd%2BjhLKgKEmdudW1rq3V1Y15kzxIU%3D&h=051c0c3e\" target=\"_blank\">https://groups.google.com/forum/m/#!topic/nix-devel/KV9eomIdxWE</a>"},{"pid":"a353a599c1f12916d8d54932287a72286cda4dff","tid":443397,"uid":39012,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-21T15:01:01.000Z","msg":"蘋果咁撚串<img src=\"/assets/faces/normal/dead.gif\" class=\"hkgmoji\" />"},{"pid":"11b713c22df35ade95447f282277366f763cf0ff","tid":443397,"uid":71303,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-21T20:33:06.000Z","msg":"更新完還原唔到，無backup<img src=\"/assets/faces/normal/dead.gif\" class=\"hkgmoji\" />"},{"pid":"dd07b44c9958c8818fcc6a98481e0cfd8261b1c5","tid":443397,"uid":65408,"like":1,"dislike":0,"score":1,"citedBy":0,"replyTime":"2017-10-21T23:06:28.000Z","msg":"<blockquote>是的，這是 local 端實體電腦的漏洞，而不是現在大家比較關注的網路漏洞，看似沒啥大不了，然而試想，除了你可在蘋果電腦商場把展示電腦弄當機，如果你看使用蘋果電腦的同學、同事不爽，就可以趁他離開座位不在時，輕易讓他目前的心血瞬間付之東流，而這到底算不算安全問題呢？</blockquote><br />\n<br />\n唔係好明，如果你連人地部機都可以掂到，咁你直接洗機都得啦，洗做咁多野只係為左整hang部機？"},{"pid":"d6b5f037d0f8a69306995f061cd47212aa5d7aa0","tid":443397,"uid":82851,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-21T23:17:34.000Z","msg":"FF 有人利用呢個漏洞寫病毒<br />\n一開機就後台執行<br />\n自己上網sale收費解決問題 發達大計<img src=\"/assets/faces/normal/bomb.gif\" class=\"hkgmoji\" /> <img src=\"/assets/faces/normal/bomb.gif\" class=\"hkgmoji\" />"},{"pid":"4ccebb3b842b1d4498d3d644513d522df82eb116","tid":443397,"uid":28563,"like":0,"dislike":0,"score":0,"citedBy":0,"replyTime":"2017-10-22T04:56:10.000Z","msg":"local user dos點都要比個cve啦，apple咁做野既<br />\n邊個用mac做server就真係笑死人"}]}